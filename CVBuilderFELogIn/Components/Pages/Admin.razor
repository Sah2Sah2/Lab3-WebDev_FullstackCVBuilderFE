@page "/admin"

@using CVBuilderFELogIn.Services
@using CVBuilderFELogIn.Models
@using Microsoft.AspNetCore.Authorization

@inject ApiService ApiService
@inject NavigationManager Navigation
@inject HttpClient Http

@rendermode InteractiveServer

@attribute [Authorize(Roles = "Admin")]

<div class="admin-panel">
    <h3 class="admin-title">Admin Panel</h3>

    <div class="home-icon">
        <a href="/" title="Landing Page">
            <i class="fas fa-home"></i>
        </a>
    </div>

    <h2 class="admin-operations"> Add new skills and projects </h2>

    <!-- Projects Section -->
    <div class="section">
        <h4>Projects</h4>
        <div class="form">
            <label for="projectName">Project Name</label>
            <input type="text" id="projectName" @bind="newProject.Name" />

            <label for="projectCourse">Course</label>
            <input type="text" id="projectCourse" @bind="newProject.Course" />

            <label for="projectDescription">Project Description</label>
            <textarea id="projectDescription" @bind="newProject.Description"></textarea>

            <label for="projectGitHub">GitHub Link</label>
            <input type="text" id="projectGitHub" @bind="newProject.GitHubLink" />

            <button class="btn btn-submit" @onclick="CreateProject">Add</button>
        </div>

        <!-- Confirmation Message for Project Creation -->
        @if (!string.IsNullOrEmpty(confirmationMessageForCreateProject))
        {
            <div class="confirmation-message success">
                @confirmationMessageForCreateProject
            </div>
        }
    </div>

    <!-- Skills Section -->
    <div class="section">
        <h4>Skills</h4>
        <div class="form">
            <label for="skillName">Skill Name</label>
            <input type="text" id="skillName" @bind="newSkill.Name" />

            <label for="skillExperience">Years of Experience</label>
            <input type="number" id="skillExperience" @bind="newSkill.YearsOfExperience" />

            <label for="skillLevel">Skill Level</label>
            <input type="number" id="skillLevel" @bind="newSkill.SkillLevel" />

            <button class="btn btn-submit" @onclick="CreateSkill">Add</button>
        </div>

        <!-- Confirmation Message for Skill Creation -->
        @if (!string.IsNullOrEmpty(confirmationMessageForCreateSkill))
        {
            <div class="confirmation-message success">
                @confirmationMessageForCreateSkill
            </div>
        }
    </div>

    <!-- Delete Project Section -->
    <div class="section">
        <h4>Delete Project</h4>
        <div>
            <select @bind="selectedProjectId">
                <option value="">Select a project to delete</option>
                @foreach (var project in projects)
                {
                    <option value="@project.Id">@project.Name</option>
                }
            </select>
            <br />
            <button class="btn btn-delete" @onclick="DeleteProject">Delete</button>
        </div>

        <!-- Confirmation Message for Project Deletion -->
        @if (!string.IsNullOrEmpty(confirmationMessageForDeleteProject))
        {
            <div class="confirmation-message success">
                @confirmationMessageForDeleteProject
            </div>
        }
    </div>

    <!-- Delete Skill Section -->
    <div class="section">
        <h4>Delete Skill</h4>
        <div>
            <select @bind="selectedSkillId">
                <option value="">Select a skill to delete</option>
                @foreach (var skill in skills)
                {
                    <option value="@skill.Id">@skill.Name</option>
                }
            </select>
            <br />
            <button class="btn btn-delete" @onclick="DeleteSkill">Delete</button>
        </div>

        <!-- Confirmation Message for Skill Deletion -->
        @if (!string.IsNullOrEmpty(confirmationMessageForDeleteSkill))
        {
            <div class="confirmation-message success">
                @confirmationMessageForDeleteSkill
            </div>
        }
    </div>
</div>



@code {
    private Project newProject = new Project();
    private Skill newSkill = new Skill();
    private int selectedProjectId;
    private int selectedSkillId;

    private List<Project> projects = new List<Project>();
    private List<Skill> skills = new List<Skill>();

    private string confirmationMessageForCreateProject;
    private string confirmationMessageForCreateSkill;
    private string confirmationMessageForDeleteProject;
    private string confirmationMessageForDeleteSkill;

   
    protected override async Task OnInitializedAsync()
    {
        projects = await ApiService.GetProjectsAsync();
        skills = await ApiService.GetSkillsAsync();
    }

    // CREATE PROJECT
    private async Task CreateProject()
    {
        var createdProject = await ApiService.CreateProjectAsync(newProject);
      
        newProject = new Project(); 
        projects = await ApiService.GetProjectsAsync(); 

        confirmationMessageForCreateProject = "Project created successfully!";
        confirmationMessageForDeleteProject = null; 
    }

    // DELETE PROJECT
    private async Task DeleteProject()
    {
        if (selectedProjectId == 0)
        {
            return;
        }

        await ApiService.DeleteProjectAsync(selectedProjectId);
       
        projects = await ApiService.GetProjectsAsync(); 
        selectedProjectId = 0; 

        confirmationMessageForDeleteProject = "Project deleted successfully!";
        confirmationMessageForCreateProject = null; 
    }

    // CREATE SKILL 
    private async Task CreateSkill()
    {
        var createdSkill = await ApiService.CreateSkillAsync(newSkill);
      
        newSkill = new Skill();
        skills = await ApiService.GetSkillsAsync(); 

        confirmationMessageForDeleteSkill = null;
        confirmationMessageForCreateSkill = "Skill created successfully!";
    }

    // DELETE SKILL
    private async Task DeleteSkill()
    {
        if (selectedSkillId == 0)
        {
            return;
        }

        await ApiService.DeleteSkillAsync(selectedSkillId);
       
        skills = await ApiService.GetSkillsAsync(); 
        selectedSkillId = 0; 

        confirmationMessageForDeleteSkill = "Skill deleted successfully!";
        confirmationMessageForCreateSkill = null; 

    }
}
